// arrays containg the words for the game to display and the user to type
let shortWords = ["the","of","and","to","a","in","for","is","on","that","by","this","with","i","you","it","not","or","be","are","from","at","as","your","all","have","new","more","an","was","we","will","home","can","us","if","page","my","has","free","but","our","one","do","no","time","they","site","he","up","may","what","news","out","use","any","see","only","so","his","when","here","who","web","also","now","help","get","pm","view","c","e","am","been","how","were","me","s","some","its","like","x","than","find","date","back","top","had","list","name","just","over","year","day","into","two","n","re","next","used","go","b","work","last","most","buy","data","make","them","post","her","city","t","add","such","best","then","jan","good","well","d","info","high","m","each","she","very","book","r","read","need","many","user","said","de","does","set","mail","full","map","life","know","way","days","p","part","real","f","item","ebay","must","made","off","line","did","send","type","car","take","area","want","dvd","l","long","w","code","show","o","even","much","sign","file","link","open","case","same","uk","own","both","g","game","care","down","end","h","him","per","big","law","size","art","shop","text","rate","usa","v","form","love","old","john","main","call","non","k","y","why","cd","save","low","york","man","card","jobs","j","food","u","sale","job","teen","room","too","join","men","west","look","left","team","box","gay","week","note","live","june","air","plan","tv","yes","hot","cost","la","say","july","test","come","dec","pc","cart","san","play","tax","less","got","blog","let","park","side","act","red","give","q","sell","key","body","few","east","ii","age","club","z","road","gift","ca","hard","oct","pay","four","war","nov","blue","al","easy","fax","yet","star","hand","sun","rss","id","keep","baby","run","net","term","film","put","co","try","head","cell","self","away","once","log","sure","faq","cars","tell","able","fun","gold","feb","sep","arts","lot","ask","past","due","et","five","upon","says","mar","land","done","pro","st","url","aug","ever","ago","word","bill","apr","talk","via","kids","true","else","mark","rock","bad","tips","plus","auto","edit","fast","fact","unit","tech","meet","far","en","feel","bank","risk","jul","town","jun","girl","toys","golf","loan","wide","sort","half","step","none","paul","lake","sony","fire","chat","html","loss","face","oil","bit","base","near","oh","stay","turn","mean","king","copy","drug","pics","cash","bay","ad","seen","port","stop","bar","dog","soon","held","ny","eur","mind","pdf","lost","tour","menu","hope","wish","role","came","usr","dc","mon","com","fine","hour","gas","six","bush","pre","huge","sat","zip","bid","kind","move","logo","nice","ok","sent","band","ms","lead","went","fri","hi","mode","fund","wed","male","took","inn","song","cnet","ltd","los","hp","late","fall","idea","inc","win","tool","eg","bed","ip","hill","maps","deal","hold","tue","safe","feed","pa","thu","sea","cut","hall","anti","tel","ship","tx","paid","hair","kit","tree","thus","wall","ie","el","ma","boy","wine","vote","ways","est","son","rule","mac","iii","gmt","max","told","xml","feet","bin","door","cool","md","fl","mb","asia"];
let midWords = ["about","search","other","which","their","there","contact","business","online","first","would","services","these","click","service","price","people","state","email","health","world","products","music","should","product","system","policy","number","please","support","message","after","software","video","where","rights","public","books","school","through","links","review","years","order","privacy","items","company","group","under","general","research","january","reviews","program","games","could","great","united","hotel","center","store","travel","comments","report","member","details","terms","before","hotels","right","because","local","those","using","results","office","national","design","posted","internet","address","within","states","phone","shipping","reserved","subject","between","forum","family","based","black","check","special","prices","website","index","being","women","today","south","project","pages","version","section","found","sports","house","related","security","county","american","photo","members","power","while","network","computer","systems","three","total","place","download","without","access","think","north","current","posts","media","control","water","history","pictures","personal","since","guide","board","location","change","white","small","rating","children","during","return","students","shopping","account","times","sites","level","digital","profile","previous","events","hours","image","title","another","shall","property","class","still","money","quality","every","listing","content","country","private","little","visit","tools","reply","customer","december","compare","movies","include","college","value","article","provide","source","author","press","learn","around","print","course","canada","process","stock","training","credit","point","science","advanced","sales","english","estate","select","windows","photos","thread","category","large","gallery","table","register","however","october","november","market","library","really","action","start","series","model","features","industry","human","provided","required","second","movie","forums","march","better","yahoo","going","medical","friend","server","study","staff","articles","feedback","again","looking","issues","april","never","users","complete","street","topic","comment","things","working","against","standard","person","below","mobile","party","payment","login","student","programs","offers","legal","above","recent","stores","problem","memory","social","august","quote","language","story","options","rates","create","young","america","field","paper","single","example","girls","password","latest","question","changes","night","texas","poker","status","browse","issue","range","building","seller","court","february","always","result","audio","light","write","offer","groups","given","files","event","release","analysis","request","china","making","picture","needs","possible","might","month","major","areas","future","space","cards","problems","london","meeting","become","interest","child","enter","share","similar","garden","schools","million","added","listed","learning","energy","delivery","popular","stories","journal","reports","welcome","central","images","notice","original","radio","until","color","council","includes","track","archive","others","format","least","society","months","safety","friends","trade","edition","messages","further","updated","having","provides","david","already","green","studies","close","common","drive","specific","several","living","called","short","display","limited","powered","means","director","daily","beach","natural","whether","period","planning","database","official","weather","average","window","france","region","island","record","direct","records","district","calendar","costs","style","front","update","parts","early","miles","sound","resource","present","either","document","works","material","written","federal","hosting","rules","final","adult","tickets","thing","centre","cheap","finance","minutes","third","gifts","europe","reading","topics","cover","usually","together","videos","percent","function","getting","global","economic","player","projects","lyrics","often","submit","germany","amount","watch","included","though","thanks","deals","various","words","linux","james","weight","heart","received","choose","archives","points","magazine","error","camera","clear","receive","domain","methods","chapter","makes","policies","beauty","manager","india","position","taken","listings","models","michael","known","cases","florida","simple","quick","wireless","license","friday","whole","annual","later","basic","shows"];
let longWords = ["information","available","copyright","university","management","international","development","education","community","technology","following","resources","including","directory","government","department","description","insurance","different","categories","conditions","accessories","september","questions","application","financial","equipment","performance","experience","important","activities","additional","something","professional","committee","washington","california","reference","companies","computers","president","australia","discussion","entertainment","agreement","marketing","association","collection","solutions","electronics","technical","microsoft","conference","environment","statement","downloads","applications","requirements","individual","subscribe","everything","production","commercial","advertising","treatment","newsletter","knowledge","currently","construction","registered","protection","engineering","published","corporate","customers","materials","countries","standards","political","advertise","environmental","availability","employment","commission","administration","institute","sponsored","electronic","condition","effective","organization","selection","corporation","executive","necessary","according","particular","facilities","opportunities","appropriate","statistics","investment","christmas","registration","furniture","wednesday","structure","distribution","industrial","potential","responsible","communications","associated","foundation","documents","communication","independent","operating","developed","telephone","population","navigation","operations","therefore","christian","understand","publications","worldwide","connection","publisher","introduction","properties","accommodation","excellent","opportunity","assessment","especially","interface","operation","restaurants","beautiful","locations","significant","technologies","manufacturer","providing","authority","considered","programme","enterprise","educational","employees","alternative","processing","responsibility","resolution","publication","relations","photography","components","assistance","completed","organizations","otherwise","transportation","disclaimer","membership","recommended","background","character","maintenance","functions","trademarks","phentermine","submitted","television","interested","throughout","established","programming","regarding","instructions","increased","understanding","beginning","associates","instruments","businesses","specified","restaurant","procedures","relationship","traditional","sometimes","themselves","transport","interesting","evaluation","implementation","galleries","references","presented","literature","respective","definition","secretary","networking","australian","magazines","francisco","individuals","guidelines","installation","described","attention","difference","regulations","certificate","directions","documentation","automotive","successful","communities","situation","publishing","emergency","developing","determine","temperature","announcements","historical","ringtones","difficult","scientific","satellite","particularly","functional","monitoring","architecture","recommend","dictionary","accounting","manufacturing","professor","generally","continued","techniques","permission","generation","component","guarantee","processes","interests","paperback","classifieds","supported","competition","providers","characters","thousands","apartments","generated","administrative","practices","reporting","essential","affiliate","immediately","designated","integrated","configuration","comprehensive","universal","presentation","languages","compliance","improvement","pennsylvania","challenge","acceptance","strategies","affiliates","multimedia","certified","computing","interactive","procedure","leadership","religious","breakfast","developer","approximately","recommendations","comparison","automatically","minnesota","adventure","institutions","assistant","advertisement","headlines","yesterday","determined","wholesale","extension","statements","completely","electrical","applicable","manufacturers","classical","dedicated","direction","basketball","wisconsin","personnel","identified","professionals","advantage","newsletters","estimated","anonymous","miscellaneous","integration","interview","framework","installed","massachusetts","associate","frequently","discussions","laboratory","destination","intelligence","specifications","tripadvisor","residential","decisions","industries","partnership","editorial","expression","provisions","principles","suggestions","replacement","strategic","economics","compatible","apartment","netherlands","consulting","recreation","participants","favorites","translation","estimates","protected","philadelphia","officials","contained","legislation","parameters","relationships","tennessee","representative","frequency","introduced","departments","residents","displayed","performed","administrator","addresses","permanent","agriculture","constitutes","portfolio","practical","delivered","collectibles","infrastructure","exclusive","originally","utilities","philosophy","regulation","reduction","nutrition","recording","secondary","wonderful","announced","prevention","mentioned","automatic","healthcare","maintained","increasing","connected","directors","participation","containing","combination","amendment","guaranteed","libraries","distributed","singapore","enterprises","convention","principal","certification","previously","buildings","household","batteries","positions","subscription","contemporary","panasonic","permalink","signature","provision","certainly","newspaper","liability","trademark","trackback","americans","promotion","conversion","reasonable","broadband","influence","importance","webmaster","prescription","specifically","represent","conservation","louisiana","javascript","marketplace","evolution","certificates","objectives","suggested","concerned","structures","encyclopedia","continuing","interracial","competitive","suppliers","preparation","receiving","accordance","discussed","elizabeth","reservations","playstation","instruction","annotation","differences","establish","expressed","paragraph","mathematics","compensation","conducted","percentage","mississippi","requested","connecticut","personals","immediate","agricultural","supporting","collections","participate","specialist","experienced","investigation","institution","searching","proceedings","transmission","characteristics","experiences","extremely","verzeichnis","contracts","concerning","developers","equivalent","chemistry","neighborhood","variables","continues"];


// variable declarations

    // set default array to mid length words
    let wordLength = midWords;

    // get DOM ids for word display
    const wordDisplayString = document.getElementById("word_display_string");
    // get DOM ids for word display
    const wordInput = document.getElementById("word_input");

    // Get DOM ids for info/play buttons in main game box
    const infoButton = document.getElementById("info_button");
    const playButton = document.getElementById("play_button");

    //  get DOM id for timer % in progress bar
    let timer = document.getElementById("bar").innerText;

    // get DOM id for wpm score tracker & set it to zero
    const wpmScoreBox = document.getElementById("wpm_display");
    let score = 0;

    // progress bar width
    let width = 0;
    let barWidth;

    // set sounds for timer and typing audio, sound used for mute/unmute function
    let timerSound = document.getElementById("timer_sound");
    let typeSound = document.getElementById("click_sound");
    let sound = true;

    // set default username, get DOM ids for username input/submit
    let username = "username";
    let usernameInput = document.getElementById("username_input");
    let usernameSubmit = document.getElementById("username_submit");

    // pop up info/username screen & Exit button id
    let popup = document.getElementById("popup_container");
    let exitPopup = document.getElementById("exit_popup");


    // 3 toggle buttons in info box DOM ID
    let soundToggle = document.getElementById("sound_button");
    let wordLengthToggle = document.getElementById("word_length_button");
    let usernameChange = document.getElementById("username_change");

    // highscore table ID
    let table = document.getElementById("highscore_table");



//Start & Stop Game Functions

    // start game function needed for delayed start
    function startGame() {
    renderNewWord();
    startBar();
    }

    // Run Game Function for start button event listener
    function runGame() {

      // clear all game values
      score = 0;
      wordInput.value = "";
      wordDisplayString.innerText = "";
      bar.style.width = 100 + "%";
      bar.innerHTML = "Get Ready";
      width = 100;
      wpmScoreBox.innerHTML = "0 wpm";
      wordInput.disabled = false;
      wordInput.focus();

      // start startGame function after 4s
      playTimerSound();
      setTimeout(startGame, 4000) ;

    }

    // stopGame Function
    function endGame() {

        addResult();
        wordInput.value = "";
        wordDisplayString.innerText = "";
        wordInput.disabled = true;

        bar.style.width = 0 + "%";
        bar.innerHTML = "Done!";
        width = 0;
        wpmScoreBox.innerHTML = "0 wpm";
    }

    // check if game should end function
    function checkEndGame() {
      if (barWidth >= 100) {
        endGame();
      }
    }

// Game Logic

    // Render New Word Function
     function renderNewWord() {

        // random word generator
        var random = Math.floor(Math.random() * wordLength.length);

        // get a random word and clear the string display
        let word = wordLength[random];
        wordDisplayString.innerHTML = "";

        // for each character in the word array create a 1 char span
        word.split("").forEach(character => {
            const characterSpan = document.createElement("span");
            characterSpan.innerText = character;
            wordDisplayString.appendChild(characterSpan);
          })

         // set input to null and focus it
        wordInput.value = null;
        wordInput.focus();
    }


    // Compare Word Function
    wordInput.addEventListener("input", () => {

        // set variables for the spans of dipslayed word and the current input
        const arrayWord = wordDisplayString.querySelectorAll("span");
        const arrayValue = wordInput.value.split("");

        // for each span check if it is empty, correct or incorrect and adjust correct value accordingly
        let correct = true;
        arrayWord.forEach((characterSpan, index) => {
            const character = arrayValue[index];
            if (character == null) {
              characterSpan.classList.remove("correct");
              characterSpan.classList.remove("incorrect");
              correct = false;
            } else if (character === characterSpan.innerText) {
              characterSpan.classList.add("correct");
              characterSpan.classList.remove("incorrect");
            } else {
              characterSpan.classList.remove("correct");
              characterSpan.classList.add("incorrect");
              correct = false;
            }
        })

        // if correct is true render a new word and iterate the score
        if (correct &&  barWidth > 0 ) {
            renderNewWord();
            score += 1;
            wpmScoreBox.innerHTML =  score + "wpm";
            console.log(score);
        }

        })

    // Progress Bar functions
    // initialize i variable
    var i = 0;

    // start progress bar function
    function startBar() {
        if (i == 0) {
        i = 1;
        width = 0;
        var id = setInterval(tick, 10);

    // 1 tick function of progress bar 1 tick = 100ms and
    function tick() {
          if (width >= 100 ) {
          clearInterval(id);
          i = 0;
          checkEndGame();
          } else {
              adjustWidth();
        }

      // adjust width of progress bar and % displayed each tick
      function adjustWidth() {
        width += 0.0166666666666667;
        bar.style.width = width + "%";
        bar.innerHTML = width.toFixed(1) + "%";

        // set width value to a var
        barWidth = width;
      }

      }
    }
  }






    //  Start Game Button Click Listener
    playButton.addEventListener("click", runGame);

    // Info Button Click Listener
    infoButton.addEventListener("click", openPopup);


// Pop up username input / Game Information functions

  // Open  Popup Function
  function openPopup() {
    popup.style.display = "block";
    usernameInput.placeholder = username;
  }

  // Close Popup Function
  function closePopup() {
    popup.style.display = "none";
  }

  // exit pop up listeners for click through exit and corner "x" exit
  exitPopup.addEventListener("click", closePopup);

  popup.addEventListener("click", function(event) {
    if (event.target == popup) {
      popup.style.display = "none";
    }
  })

  // pop up when loaded event listener
  document.addEventListener("DOMContentLoaded", openPopup);

   // set username function
   function setUsername() {
    username = usernameInput.value;
    usernameChange.innerHTML = username;
    alert("username changed to " + username);
  }

  // username submit event listener
  usernameSubmit.addEventListener("click", setUsername);


// Highscore table functions

  // get current time function
  let today = Date.now();
  let todayDate = new Date(today);

    function getCurrentTimeDate() {
      let today = Date.now();
      let todayDate = new Date(today);
      let date = todayDate.toDateString();
      let time = todayDate.toLocaleTimeString("en-US");
      let currentTimeDate = `${time} - ${date}`;
      return currentTimeDate;
    } console.log(getCurrentTimeDate());

  // submit game results to high score table function
  function addResult() {
    let highscore = score;

    let row = table.insertRow(1);
    let cell0 = row.insertCell(0);
    let cell1 = row.insertCell(1);
    let cell2 = row.insertCell(2);
    cell0.innerHTML = username;
    cell1.innerHTML = highscore + "wpm";
    cell2.innerHTML = getCurrentTimeDate();
  }

// Info box button bar functions

  // toggle word length function
  function toggleLength() {
    if (wordLengthToggle.innerHTML == "Mid") {
      wordLengthToggle.innerHTML = "Long";
      wordLength = longWords;

    } else if (wordLengthToggle.innerHTML == "Long") {
      wordLengthToggle.innerHTML = "Short";
      wordLength = shortWords;

    } else {
      wordLengthToggle.innerHTML = "Mid";
      wordLength = midWords;
    }
  }


  // toggle sound icon
  function toggleSoundIcon() {

    var soundIcon = document.getElementById("sound_icon");

    if (soundIcon.className === "fas fa-volume-up") {
      soundIcon.className = "fas fa-volume-mute";
      sound = false;


    } else {
      soundIcon.className = "fas fa-volume-up";
      sound = true;
      }
    }


// button bar event listeners

  // word length change event listener
  wordLengthToggle.addEventListener("click",toggleLength);

  // username change button event listener
  usernameChange.addEventListener("click", openPopup);

  // sound mute/unmute button event listeners
  // soundToggle.addEventListener("click", toggleSound);
  soundToggle.addEventListener("click",toggleSoundIcon);


// sound functions

  // play typing sound function
  function playTypeSound() {
    if (sound) {
      typeSound.play();
    }
  }

  // play timer sound function
  function playTimerSound() {
    if (sound) {
      timerSound.play();
    }
  }

  //typing sound function
  wordInput.addEventListener("input", playTypeSound);